<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>PlotOMatic v0.5g — Toolbar Semantic Consolidation (Phase 1)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 12px; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .panel { display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap; }
    .box { border:1px solid #ddd; border-radius:12px; padding:10px; }
    canvas { border: 1px solid #999; cursor: crosshair; display:block; margin-top:10px; }
    label { display:inline-flex; gap:6px; align-items:center; }
    input[type="number"]{ width: 92px; }
    textarea { width: 100%; height: 180px; margin-top:10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .small { font-size: 0.9rem; color:#444; }
    .hint { color:#555; font-size: 0.95rem; margin-top:8px; line-height: 1.3; }
    .btn { padding: 4px 10px; border:1px solid #ccc; border-radius:12px; background:#fff; cursor:pointer; }
    .btn:hover { background:#f6f6f6; }
    .btn.on { border-color:#444; background:#f2f2f2; }
    .seg { border-top:1px dashed #ddd; margin-top:10px; padding-top:10px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border-bottom: 1px solid #eee; padding: 6px 8px; }
    th { background:#fafafa; position: sticky; top:0; text-align:left; }
    td.r { text-align:right; }
    .warn { color:#b00; }
    .ok { color:#070; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:0.85rem; }

    .groupTitle{ font-weight:700; margin-bottom:6px; }
    .toolGroup{ border:1px solid #e5e5e5; border-radius:12px; padding:10px; margin-top:10px; }
    .toolGroup .row{ margin-top:6px; }
    .toolGroup .row:first-child{ margin-top:0; }
    .canvasbar{ display:flex; justify-content:space-between; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px; }
    .canvasbar .left, .canvasbar .right{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }


    #toolMeaningRow{
        padding: 4px 8px;
        border: 1px dashed #777;
         border-radius: 6px;
        }
        #toolMeaningText{
         margin-left: 8px;
        opacity: 0.95;
        }

tr.entityRow.selected { background: #f2f2f2; }

tr.entityRow .dots{
  display:none;
  padding:2px 8px;
  border:1px solid #777;
  border-radius:6px;
  background:transparent;
  cursor:pointer;
  font-size:14px;
  line-height:18px;
}

tr.entityRow.selected .dots{ display:inline-block; }

</style>
</head>
<body>

<h3>PlotOMatic v0.5g — Toolbar Semantic Consolidation (Phase 1)</h3>

<div class="panel">

  <div class="box">

    <div class="toolGroup" id="viewGroup">
      <div class="groupTitle">View</div>
      <div class="row">
      <label>Units:
        <select id="units">
          <option value="in">Inches</option>
          <option value="mm">Millimeters</option>
        </select>
      </label>

      <label>Grid step:
        <input id="gridStep" type="number" value="0.25" step="0.01" min="0.001">
      </label>

      <label>Snap:
        <input id="snap" type="checkbox" checked>
      </label>

      <label>Major every:
        <input id="majorEvery" type="number" value="4" step="1" min="1">
      </label>

      <label>View width:
        <input id="viewWidth" type="number" value="12" step="0.5" min="1">
      </label>

      <button id="apply" class="btn">Apply</button>
    </div>

    <div class="row" style="margin-top:8px;">
      <label>Coord flavor:
        <select id="coordFlavor">
          <option value="neutral">Neutral</option>
          <option value="haas">Haas Work (X0,Y0)</option>
        </select>
      </label>

      <label>X0:
        <input id="x0" type="number" value="0" step="0.001">
      </label>
      <label>Y0:
        <input id="y0" type="number" value="0" step="0.001">
      </label>

      <button id="setZero" class="btn">Set X0,Y0</button>
      <button id="pickZero" class="btn">Pick X0,Y0</button>

      
      <button id="centerViewZero" class="btn" type="button">Center View on X0,Y0</button>
      <button id="resetView" class="btn" type="button">Reset View</button>

    </div>
    </div>

    <div class="toolGroup" id="sessionGroup">
  <div class="groupTitle">Session</div>
  <div class="row">
    <button id="snapshot" class="btn">Snapshot</button>
    <button id="saveSessionAs" class="btn">Save Session As…</button>
    <button id="loadSession" class="btn">Load Saved Session…</button>
    <input id="loadSessionFile" type="file" accept=".json,application/json" style="display:none;">
  </div>
  <div class="small hint">Session = canonical authoring state (resume work). Exports are generated separately.</div>
</div>

<div class="toolGroup" id="exportGroup">
  <div class="groupTitle">Export</div>
  <div class="row">
    <label>Export:
      <select id="exportMode">
        <option value="csv">CSV</option>
        <option value="gcode">G-code</option>
        <option value="pmir">PseudoMatic IR (Core1)</option>
        <option value="teach">Teaching Pseudocode</option>
      </select>
    </label>

    <label class="small" style="gap:6px;">
      <input id="markPoints" type="checkbox" checked>
      Render DATUM points as marks
    </label>

    <label>Pseudocode verb:
      <select id="psVerb">
        <option value="MOVE_TO">MOVE_TO</option>
        <option value="GO_TO">GO_TO</option>
        <option value="LINE_TO">LINE_TO</option>
      </select>
    </label>

    <button id="export" class="btn">Export</button>
  </div>
  <div class="small hint">Export = derived output (regenerable). Not saved inside session.</div>
</div>

      <div class="toolGroup" id="drawGroup">
      <div class="groupTitle">Draw</div>
      <div class="row">
        <button id="toolPoint" class="btn on">Point</button>
        <button id="toolDrill" class="btn">Drill</button>
        <button id="toolLine" class="btn">Line</button>
        <button id="toolPolyline" class="btn">Polyline</button>
        <label class="small" style="gap:6px; align-items:center;">
          <input id="polyClosed" type="checkbox">
          Closed
        </label>
        <button id="toolArc3" class="btn">Arc (3pt)</button>
        <button id="toolCircle2" class="btn">Circle (Center+R)</button>
        <button id="toolRect2" class="btn">Rectangle</button>
    
        <label>Curve sample step:
          <input id="sampleStep" type="number" value="0.10" step="0.01" min="0.001">
        </label>
      </div>
      
      <!-- RUMBLE STRIP: Tool meaning (mobile-safe, no hover required) -->
      <div class="row" id="toolMeaningRow" style="margin-top:6px;">

    <b>Tool</b>
    <span class="muted">(• Tip: Hold Shift to temporarily disable snap)</span>:

        <span class="small" id="toolMeaningText">—</span>
      </div>
    </div>


      <div class="toolGroup" id="generatorsGroup">
<div class="seg" style="margin-top:10px;">
      <div class="groupTitle">Generators</div>

      <div class="row" style="margin-top:6px; align-items:center; flex-wrap:wrap;">
        <span class="small"><b>N-gon</b></span>
        <label class="small">Sides
          <input id="ngonSides" type="number" min="3" step="1" value="6" style="width:70px;">
        </label>
        <label class="small">Radius
          <input id="ngonRadius" type="number" step="0.1" value="1.0" style="width:90px;">
        </label>
        <label class="small">Start ° 
          <input id="ngonStartDeg" type="number" step="1" value="0" style="width:70px;">
        </label>
        <button id="ngonCenterFromCursor" class="btn" type="button">Center = cursor</button>
        <label class="small">Center X
          <input id="ngonCx" type="number" step="0.1" value="0" style="width:90px;">
        </label>
        <label class="small">Center Y
          <input id="ngonCy" type="number" step="0.1" value="0" style="width:90px;">
        </label>
        <label class="small" style="gap:6px; align-items:center;">
          <input id="ngonAsPolyline" type="checkbox" checked>
          Polyline
        </label>
        <label class="small" style="gap:6px; align-items:center;">
          <input id="ngonAsDrills" type="checkbox">
          Drills at vertices
        </label>
        <button id="ngonMake" class="btn" type="button">Create</button>
      </div>

      <div class="row" style="margin-top:8px; align-items:center; flex-wrap:wrap;">
        <span class="small"><b>Circle subdivision</b></span>
        <label class="small">Divisions
          <input id="subDiv" type="number" min="3" step="1" value="12" style="width:70px;">
        </label>
        <label class="small">Radius
          <input id="subRadius" type="number" step="0.1" value="1.0" style="width:90px;">
        </label>
        <label class="small">Start °
          <input id="subStartDeg" type="number" step="1" value="0" style="width:70px;">
        </label>
        <button id="subCenterFromCursor" class="btn" type="button">Center = cursor</button>
        <label class="small">Center X
          <input id="subCx" type="number" step="0.1" value="0" style="width:90px;">
        </label>
        <label class="small">Center Y
          <input id="subCy" type="number" step="0.1" value="0" style="width:90px;">
        </label>

        <label class="small" style="gap:6px; align-items:center;">
          <input id="subAsDrills" type="checkbox" checked>
          Drills
        </label>
        <label class="small" style="gap:6px; align-items:center;">
          <input id="subAsPolygon" type="checkbox">
          Polygon (polyline)
        </label>
        <button id="subMake" class="btn" type="button">Create</button>
      </div>

      <div class="small hint">
        Notes: N-gon and subdivision share the same vertex math. Subdivision can also create a polygon; N-gon can optionally add drill points at vertices.
      </div>
    </div>
</div>

<!-- UNDERLAY (Tracing overlay) -->
      <div class="seg" style="margin-top:8px;">
        <div class="small"><b>Tracing Underlay</b> (image overlay)</div>
        <div class="row" style="margin-top:6px; align-items:center;">
          <input id="underlayFile" type="file" accept="image/*" class="small">
          <button id="underlayClear" class="btn" type="button">Clear</button>
          <label class="small" style="gap:6px; align-items:center;">
            <input id="underlayLock" type="checkbox" checked>
            Lock
          </label>
        </div>
        <div class="row" style="margin-top:6px; align-items:center; flex-wrap:wrap;">
          <label class="small">Opacity
            <input id="underlayOpacity" type="range" min="0" max="1" step="0.01" value="0.45" style="width:160px;">
          </label>
          <label class="small">Scale (mm/px)
            <input id="underlayScale" type="number" step="0.01" value="1.00" style="width:90px;">
          </label>
          <button id="underlayFit" class="btn" type="button">Fit to View</button>
          <label class="small">W
            <input id="underlayW" type="number" step="0.1" placeholder="(units)" style="width:90px;">
          </label>
          <label class="small">H
            <input id="underlayH" type="number" step="0.1" placeholder="(units)" style="width:90px;">
          </label>
          <button id="underlayApplySize" class="btn" type="button">Apply Size</button>

          <label class="small">X
            <input id="underlayX" type="number" step="0.1" value="0" style="width:90px;">
          </label>
          <label class="small">Y
            <input id="underlayY" type="number" step="0.1" value="0" style="width:90px;">
          </label>
          <button id="underlayToCursor" class="btn" type="button">Set XY to cursor</button>
          <button id="underlayReset" class="btn" type="button">Reset</button>
        </div>
        <div class="small hint">
          Tip: Load a photo/drawing, adjust opacity/scale, set XY, then trace with Line/Polyline/Arc/Circle.
          (Tip: unlock + Alt-drag to slide image under grid. Use W/H or Fit to match grid scale.)
        </div>
      </div>
    </div>


<div class="canvasbar">
  <div class="left">
    <span class="pill" id="featureHint"></span>
    <button id="undo" class="btn" type="button">Undo</button>
    <button id="redo" class="btn" type="button">Redo</button>
    <button id="clear" class="btn" type="button">Clear</button>
  </div>
  <div class="right">
    <span id="readout" class="mono"></span>
  </div>
</div>

    <canvas id="cv" width="1100" height="650"></canvas>
    <textarea id="out" class="mono" placeholder="Export will appear here..."></textarea>



<div class="seg" id="csvPane">
  <div class="row" style="justify-content:space-between; align-items:center;">
    <div class="small"><b>Live CSV (Active feature)</b> <span class="small" id="csvStatus"></span></div>
    <div class="row" style="gap:6px;">
      <label class="small">CSV Mode:
        <select id="csvMode">
          <option value="segments" selected>Segments (CNC)</option>
          <option value="waypoints">Waypoints (Sampled)</option>
        </select>
      </label>
      <button id="copyCsv" class="btn">Copy CSV</button>
    </div>
  </div>
  <textarea id="csvLive" class="mono" style="height:160px;" placeholder="Live CSV will appear here as you add points..."></textarea>
</div>





 </div>

  <div class="box" style="min-width:420px; flex: 0 0 520px;">
    <div class="small"><b>Entities</b> (Active feature) — count: <span id="entCount">0</span></div>
    <div style="max-height:320px; overflow:auto; margin-top:6px;">
      <table>
        <thead>
          <tr><th>#</th><th>Type</th><th>Summary</th><th></th></tr>
        </thead>
        <tbody id="entTable"></tbody>
      </table>
    </div>

<div class="seg">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <div class="small"><b>Flattened Points</b> (Active feature, for export) — count: <span id="ptCount">0</span></div>
        <label class="small" style="gap:6px;">
          <input id="showDerived" type="checkbox" checked>
          Show derived points
        </label>
      </div>
      <div class="hint small">Point entities are editable. Curve/path points are derived.</div>
      <div id="ptTableWrap" style="max-height:340px; overflow:auto; margin-top:6px;">
      <table>
          <thead>
            <tr>
              <th>N</th><th class="r">X</th><th class="r">Y</th><th>Src</th>
            </tr>
          </thead>
          <tbody id="ptTable"></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<script type="module" src="js/app.js"></script>

</body>
</html>

